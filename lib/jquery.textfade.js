// Generated by CoffeeScript 1.6.3
/*!
jQuery.TextFade v 1.0.0.alpha
https://github.com/mdesantis/jquery.textfade

Copyright 2013 Maurizio De Santis
Released under the MIT license
https://github.com/mdesantis/jquery.textfade/LICENSE
*/


(function() {
  var $, TextFade;

  $ = window.jQuery;

  TextFade = function($element, action, options) {
    var BLANK_REPLACE_REGEX, SEQUENCES, blankText, capitalize, defaultSettings, sequenceClone, shuffle, text, _base,
      _this = this;
    this.$element = $element;
    BLANK_REPLACE_REGEX = /[^\n]/g;
    SEQUENCES = {
      'random': function(text) {
        var _i, _ref, _results;
        return shuffle((function() {
          _results = [];
          for (var _i = 0, _ref = text.length; 0 <= _ref ? _i <= _ref : _i >= _ref; 0 <= _ref ? _i++ : _i--){ _results.push(_i); }
          return _results;
        }).apply(this));
      },
      'ltr_ttb': function(text) {
        var c, i, j, line, lines, seq, seqi, _i, _j, _len, _ref;
        seq = [];
        c = 0;
        lines = text.match(/.+\n?|\n/g);
        for (i = _i = 0, _len = lines.length; _i < _len; i = ++_i) {
          line = lines[i];
          seqi = seq[i] = [];
          for (j = _j = 0, _ref = line.length - 1; 0 <= _ref ? _j <= _ref : _j >= _ref; j = 0 <= _ref ? ++_j : --_j) {
            seqi.push(c++);
          }
        }
        return seq.reverse().reduce(function(a, b) {
          return a.concat(b);
        });
      }
    };
    capitalize = function(string) {
      return "" + (string.charAt(0).toUpperCase()) + (string.slice(1));
    };
    shuffle = function(array) {
      var i, j, x;
      i = array.length;
      while (i) {
        j = Math.floor(Math.random() * i);
        x = array[--i];
        array[i] = array[j];
        array[j] = x;
      }
      return array;
    };
    defaultSettings = function() {
      return {
        'text': null,
        'milliseconds': 1,
        'threads': 1,
        'sequence': 'random'
      };
    };
    this._trigger = function(event_type, action) {
      this.$element.trigger("" + event_type + ".textFade" + (capitalize(action)));
      return this.$element.trigger("" + event_type + ".textFade", [action]);
    };
    this._replace = function(sequence) {
      var character, index, text;
      index = sequence.shift();
      text = this.$element.text();
      character = this.endText.charAt(index);
      return this.$element.text("" + (text.substr(0, index)) + character + (text.substr(index + character.length)));
    };
    this._step = function(sequence) {
      var i, _i, _ref;
      for (i = _i = 1, _ref = this.settings.threads; 1 <= _ref ? _i <= _ref : _i >= _ref; i = 1 <= _ref ? ++_i : --_i) {
        if (sequence.length === 0) {
          window.clearInterval(this.interval);
          this._trigger('complete', action);
          return;
        }
        this._replace(sequence);
      }
    };
    this.settings = $.extend(defaultSettings(), options);
    text = (_base = this.settings).text != null ? (_base = this.settings).text : _base.text = this.$element.text();
    if (typeof this.settings.sequence === 'string') {
      this.settings.sequence = SEQUENCES[this.settings.sequence](text);
    } else if ($.isFunction(this.settings.sequence)) {
      this.settings.sequence = this.settings.sequence(text);
    } else {

    }
    console.log(text.length, this.settings.sequence.length);
    sequenceClone = this.settings.sequence.slice(0);
    blankText = text.replace(BLANK_REPLACE_REGEX, ' ');
    switch (action) {
      case 'in':
        this.begText = blankText;
        this.endText = text;
        break;
      case 'out':
        this.begText = text;
        this.endText = blankText;
    }
    this.$element.text(this.begText);
    this._trigger('start', action);
    this.interval = window.setInterval(function() {
      return _this._step(sequenceClone);
    }, this.settings.milliseconds);
    return this;
  };

  $.fn.textFadeIn = function(options) {
    return this.each(function() {
      return new TextFade($(this), 'in', options);
    });
  };

  $.fn.textFadeOut = function(options) {
    return this.each(function() {
      return new TextFade($(this), 'out', options);
    });
  };

  $.fn.textFade = function(action, options) {
    return this.each(function() {
      return new TextFade($(this), action, options);
    });
  };

}).call(this);
